<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>优化后的幻灯片（抖动缩小效果）</title>
<style>
@font-face{font-family:FontStyle;src:url(".");font-display:fallback;}
@font-face {font-family: "shishang";src: url(".");font-display:fallback;}
*{padding:0;margin:0;box-sizing:border-box;
}html{font-size:10px;}body{background-color:#000;
}.slideshow{width:100%;height:100vh;
position:relative;overflow:hidden;
}.slideshow-item{width:inherit;
height:inherit;position
height:inherit;position:absolute;
opacity:0;
}
.slideshow-item img{width:100%;
height:100%;object-fit:cover;
}
.slideshow-item-text{max-width:50%;
position:absolute;
top:50%;
transform:translateY(-50%);
left:0;
background-color:rgba(0,0,0,0.8);
color:#fff;
padding:10rem 5rem;
font-family:'Raleway',sans-serif;
}
.slideshow-item-text h5{font-size:3.5rem;
letter-spacing:3px;
font-family:shishang,'微软雅黑';
}.slideshow-item-text p{font-weight:300;
font-size:1.6rem;
margin-top:2rem;
font-family:FontStyle,'微软雅黑';
}

/* 抖动缩小转场效果样式 */
.shake-scale {
  animation: shakeScale 1s ease-in-out;
}

@keyframes shakeScale {
  0% { transform: scale(1) translateX(0); opacity: 1; }
  10% { transform: scale(0.98) translateX(-5px); }
  20% { transform: scale(0.98) translateX(5px); }
  30% { transform: scale(0.96) translateX(-5px); }
  40% { transform: scale(0.96) translateX(5px); }
  50% { transform: scale(0.94) translateX(-3px); }
  60% { transform: scale(0.94) translateX(3px); }
  70% { transform: scale(0.92) translateX(-3px); }
  80% { transform: scale(0.92) translateX(3px); }
  90% { transform: scale(0.9) translateX(-2px); }
  100% { transform: scale(0.8) translateX(0); opacity: 0; }
}

/* 加载指示器 */
.loading {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.5s ease;
}

.loading.hidden {
  opacity: 0;
  pointer-events: none;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid rgba(255, 255, 255, 0.1);
  border-top: 5px solid #ffffff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* 图片加载状态 */
.slideshow-item img {
  opacity: 0;
  transition: opacity 0.5s ease;
}

.slideshow-item img.loaded {
  opacity: 1;
}

@media screen and (max-width:1100px){.slideshow-item-text{max-width:75%;
}}
@media screen and (max-width:768px){.slideshow-item-text{padding:3rem 1.5rem;
}}
@media screen and (max-width:456px){.slideshow-item-text{max-width:100%;
top:inherit;
transform:translateY(0);
bottom:0;}.slideshow-item-text h5{font-size:2rem;
}.slideshow-item-text p{font-size:1rem;
}}
</style> 
</head>
<body>
  <!-- 加载指示器 -->
  <div class="loading">
    <div class="loading-spinner"></div>
    <div style="color: white; margin-top: 20px; font-family: Arial, sans-serif;">加载中...</div>
  </div>

  <div class="slideshow">
    <div class="slideshow-item" style="opacity: 1;">
        <img src="https://i.postimg.cc/5Y1pKGz1/wsrjcck1.jpg" alt="图片1">
    </div>
    <div class="slideshow-item">
        <img src="https://i.postimg.cc/gXDsCDyr/wsrjcck3.jpg" alt="图片2">
    </div>
    <div class="slideshow-item">
        <img src="https://i.postimg.cc/sQcmkcPx/wsrjcck2.jpg" alt="图片3">
    </div>
    <div class="slideshow-item">
        <img src="https://i.postimg.cc/Q9bm2bgH/wsrjcck4.jpg" alt="图片4">
    </div>
    <div class="slideshow-item">
        <img src="https://i.postimg.cc/k6cs0cN2/wsrjcck5.jpg" alt="图片5">
    </div>
    <div class="slideshow-item">
        <img src="https://i.postimg.cc/T530fDQW/wsrjcck6.jpg" alt="图片6">
    </div>
  </div>  

<script>
    // 基础变量
    let currentIndex = 0;
    const slides = document.querySelectorAll('.slideshow-item');
    const totalSlides = slides.length;
    let timer;
    let isTransitioning = false;
    
    // 图片预加载
    function preloadImages() {
      const promises = [];
      
      slides.forEach(slide => {
        const img = slide.querySelector('img');
        if (img) {
          const promise = new Promise((resolve, reject) => {
            // 创建新的图片对象进行预加载
            const preloadImg = new Image();
            preloadImg.src = img.src;
            
            preloadImg.onload = () => {
              // 预加载完成后，设置原始图片为已加载
              img.classList.add('loaded');
              resolve();
            };
            
            preloadImg.onerror = () => {
              console.error(`图片预加载失败: ${img.src}`);
              // 即使加载失败，也标记为已加载，避免阻塞
              img.classList.add('loaded');
              resolve();
            };
            
            // 超时处理
            setTimeout(() => {
              if (!img.classList.contains('loaded')) {
                console.warn(`图片预加载超时: ${img.src}`);
                img.classList.add('loaded');
                resolve();
              }
            }, 5000);
          });
          promises.push(promise);
        }
      });
      
      return Promise.all(promises);
    }
    
    // 初始化
    function init() {
      // 预加载所有图片
      preloadImages().then(() => {
        // 隐藏加载指示器
        const loadingIndicator = document.querySelector('.loading');
        if (loadingIndicator) {
          loadingIndicator.classList.add('hidden');
          // 等待动画结束后完全移除
          setTimeout(() => {
            loadingIndicator.style.display = 'none';
          }, 500);
        }
        
        // 确保第一张图片显示
        const firstSlide = slides[0];
        if (firstSlide) {
          firstSlide.style.opacity = '1';
          const firstImage = firstSlide.querySelector('img');
          if (firstImage) {
            firstImage.classList.add('loaded');
          }
        }
        
        // 启动定时器
        startTimer();
      });
    }
    
    // 清除效果
    function clearEffects() {
      slides.forEach(slide => {
        slide.classList.remove('shake-scale');
      });
    }
    
    // 切换到下一张
    function showNext() {
      // 如果正在过渡中，则不执行新的切换
      if (isTransitioning) return;
      
      isTransitioning = true;
      clearEffects();
      
      // 记录当前索引
      const prevIndex = currentIndex;
      // 计算下一个索引
      currentIndex = (currentIndex + 1) % totalSlides;
      
      const prevSlide = slides[prevIndex];
      const targetSlide = slides[currentIndex];
      const targetImage = targetSlide.querySelector('img');
      
      // 确保目标幻灯片在最上层
      targetSlide.style.zIndex = '10';
      prevSlide.style.zIndex = '5';
      
      // 检查目标图片是否已加载
      if (targetImage && targetImage.classList.contains('loaded')) {
        // 图片已加载，直接显示
        targetSlide.style.opacity = '1';
        applyShakeScaleEffect(prevSlide);
        finishTransition(prevSlide, targetSlide);
      } else if (targetImage) {
        // 图片未加载，显示加载状态
        targetSlide.style.opacity = '0.3';
        
        const loadHandler = () => {
          targetImage.classList.add('loaded');
          targetSlide.style.opacity = '1';
          targetImage.removeEventListener('load', loadHandler);
          applyShakeScaleEffect(prevSlide);
          finishTransition(prevSlide, targetSlide);
        };
        
        targetImage.addEventListener('load', loadHandler);
        
        // 超时处理：如果3秒内仍未加载完成，强制显示
        setTimeout(() => {
          if (!targetImage.classList.contains('loaded')) {
            targetImage.classList.add('loaded');
            targetSlide.style.opacity = '1';
            targetImage.removeEventListener('load', loadHandler);
            applyShakeScaleEffect(prevSlide);
            finishTransition(prevSlide, targetSlide);
          }
        }, 3000);
      } else {
        // 没有图片元素，直接显示
        targetSlide.style.opacity = '1';
        applyShakeScaleEffect(prevSlide);
        finishTransition(prevSlide, targetSlide);
      }
    }
    
    // 应用抖动缩小效果
    function applyShakeScaleEffect(slide) {
      slide.classList.add('shake-scale');
    }
    
    // 完成过渡
    function finishTransition(prevSlide, targetSlide) {
      // 效果持续时间
      const effectDuration = 1000; // 1秒
      
      // 等待效果结束后重置状态
      setTimeout(() => {
        prevSlide.style.opacity = '0';
        prevSlide.style.zIndex = '1';
        targetSlide.style.zIndex = '1';
        isTransitioning = false;
        resetTimer(); // 重置定时器，保证每张图展示7秒
      }, effectDuration);
    }
    
    // 启动定时器
    function startTimer() {
      timer = setInterval(showNext, 7000); // 7秒切换一次
    }
    
    // 重置定时器
    function resetTimer() {
      clearInterval(timer);
      startTimer();
    }
    
    // 页面加载完成后启动
    window.onload = init;
</script>
</body>
</html>
